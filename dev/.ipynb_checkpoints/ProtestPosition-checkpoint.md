## Protest Position

The goal is to incorporate the position of the protestors in the randomization. There are at least two good reason:
* Increase the number of possible combinations
* Match the task developed in Yoder & Decety (submitted [hopefully 2021])

## Current Task

The issues_with_variables object in the jsPsych timeline collects participants responses to the set of political issues.
* `familiar` : familiarity with the issues 
    * [1=Not at all.., 2=Slightly.., 3=Somewhat.., 4=Moderately.., 5=Very..]
* `support` : their support for the issue 
    * [1=Strongly oppose, 2=Oppose, 3=Somewhat oppose, 4=Neutral, 5=Somewhat support, 6=Support, 7=Strongly support]
* `mor1` and `mor2` : two items to index moral convictions, summed to obtain `moral`
    * Both use [1=Not at all, 2=Slightly, 3=Somewhat, 4=Moderately, 5=Very much]

Items with familiarity < 2 are excluded from the choice task.

Remaining items are then sorted to create unique `support` - `moral` pairs. Specific issues are then stored in a 7 x 10 array based on (support, moral).

The trial list is then generated by iterating through the set of unique `S1M1-S2M2` pairs. If a participants provided identical reatings 

In order to obtain at least 100 unique trials, there need to be at least 15 unique ratings (15 choose 2 = 105).

## Outline of next steps

The position of the protestors is reflected in the graphic as either "ThumbsUp" ![ThumbsUp](../img/ThumbsUp.jpg) or "ThumbsDown" ![ThumbsDown](../img/ThumbsDown.jpg).

Straightforward approach is to add information to `issue_array` elements that includes whether issues should be support or oppose, then dynamically update the ThumbsUp/Down image based on those values.

Terminology can get tricky here, so we need clear definitions
* `PriorSupport` is the value of `support` in the intial issue survey
* `For` indicates that the protestors favor the position and the photo will be paired with a ThumbsUp
* `Against` indicates that the protestors oppose the position and the photo will be paired with a ThumbsDown

_There is an assumption that we can symmetrically flip For and Against issues about the midpoint. This means if a person rated BLM as 6_8, then their expected support value of For_BLM is 6_8 and their expected suppor value of Against_BLM is 2_8._

One option is to add more information to issue_array so that each issue will be represented with 3 values. Currently, there are two values: [support]\_[moral]. The new system will represent issues as [support]_[moral]\_[position].

Another option is to assign each survey response to two issues, with with the original issues and original support, and another with the issue and an inverted support.

## Overview of function calls

Below are listed the elements added to the `timeline` variable in `jsPsych` along with any child calls

- `survey_inst`
- `issues_with_variables`
	*issue_trial*, *issue_list*
- `process_resps`
	+ create sorted lists
	- *unique_ratings* = `find_unique`(*support_sorted*, *moral_sorted*)
		+ generate support_moral list
		- *unique_ratings* = `removeDup`
		return unique_ratings
	- *issue_array* = `prep_issue_array`(*unique_ratings*, *issues_sorted*, *support_sorted*, *moral_sorted*)
		+ create empty array with length 7, give each element empty array of length 10
		- found = `get_issues`(*issues_sorted*, *support_sorted*, *moral_sorted*, *s*, *m*)
			+ loop over issues and return list of all issues with support and moral values included in targets
		+ update issue_array: issue_array[s][m] = `shuffle`(found)
	- *unique_pairs* = `map_unique`(*unique_ratings*)
		+ loop through for i=0:unique_ratings.length and j=i+1:unique_ratings.length to create all unique pairs (S_M_S_M)
	- *trial_list* = `populate_pairs`(*unique_pairs*, *issue_array*)
		+ iterate over unique_pairs and pull pairs of items from issue_array (if more than one S_M issues, randomly choose one)
		+ randomize left/right side
	+ update *stim_list* [iss_l, iss_r]

## Updating to code protestor position

1. Modify `find_unique`:
* for each support and moral value, create a 3-value label: [`support`]_[`moral`]\_[`For`]
* for each support and moral value, also create an inverted 3-value label: [abs(`support`-4) * -1 + 4]_[`moral`]\_[`Against`]

2. Modify `prep_issue_array`
* create an empty 7 x 10 x 2 array
* accept 3-value labels to store [`support`][`moral`][`For|Against`]
